{% extends "dupRunner/base2.html" %}
{% block content %}
<h1>
    <button id="submit" type="submit" class="btn btn-default">Submit</button>
    Selected Directories for Comparison
</h1>
<h2>
    Found {{ num_hashes_found }} duplicates across {{ num_dirs_reviewed }}
    directories reviewed.
</h2>
<div id="mydirtree" class="dirTree"></div>

<script>

    $(function () {
        $('#mydirtree')
        .jstree({
            'core': {
                'data': {
                    "dataType" : "json",
                    "contentType": "application/json",
                    "type": "POST",
                    'url': "{{ url_for('dupRunner.get_a_dir') }}",
                    'data' : function (node) {
                        return node.id ;
                    }
                },
            },
            'checkbox': {
                'keep_selected_style': true,
                'undetermined' : true
            },
            'plugins': ['checkbox'],
            'success': function(result) {
                console.log(result);
                window.location.href = "{{ url_for('dupRunner.get_a_dir') }}";
            },
            'error':
                function (jqXHR, textStatus, errorThrown) {
                    $('#mydirtree').html("<h3>Tree loading error.</h3><p>" + jqXHR.responseText + "</p>"
                        );
                }
            }
        );

        $('#mydirtree').on("changed.jstree", function (e, data) {
            console.log("The selected nodes are:");
            console.log(data.selected);
        });

        $("#submit").click(function () {
            var pdirs = $('#mydirtree').jstree("get_selected")
            $.ajax({
                url: "{{ url_for('dupRunner.get_paths') }}",
                data: JSON.stringify(pdirs),
                contentType: "application/json",
                type: "POST",
                success: function (result) {
                    console.log(result);
                    window.location.href = "{{ url_for('dupRunner.show_me_the_money') }}";
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    });


</script>
{% endblock %}
